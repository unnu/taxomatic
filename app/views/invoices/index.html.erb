<h1>alle Rechnungen</h1>

<p>Nur für das Jahr: <%= year_selector %></p>

<p><%= link_to 'Neue Rechnung', :action => 'new' %></p>

<table id="itemslist">
  <tr>
    <th>nummer</th>
    <th>datum</th>
    <th>bezahlt</th>
    <th>kunde</th>
    <th>netto</th>
    <th>brutto</th>
    <th>ust</th>
    <th>beschreibung</th>
    <th>txid</th>
    <th colspan="2">&nbsp;</th>
  </tr>

<% last_month = last_year = nil %>
<% for invoice in @invoices %>
  <tr<%= row_css(invoice, last_month, last_year) %>>
    <td><%=h invoice.ref_nr %></td>
    <td><%=h format_dmy(invoice.billed_on) %></td>
    <td>
    <% if invoice.paid_on != nil %>
      <%= format_dmy(invoice.paid_on) %>
    <% elsif invoice.reminders.length > 0 %>
      <%= link_to 'M', {:controller => 'reminders', :action => 'edit', :id => invoice.reminders.first.id}, {'title' => 'gemahnt am ' + format_dmy(invoice.reminders.first.created_on) } %>
    <% end %>
    </td>
    <td><%=h invoice.client.name %></td>
    <td class="money"><%=h format_euro(invoice.amount_net) %></td>
    <td class="money"><%=h format_euro(invoice.amount_gross) %></td>
    <td><%=h invoice.tax %>%</td>
    <td><%=h truncate(invoice.description, :length => 50) %></td>
    <td><%=h invoice.tax_declaration_id %></td>
        
    <td><%= link_to 'bearbeiten', :action => 'edit', :id => invoice %></td>
    <td><%= link_to 'als Vorlage', :action => 'new_from_template', :id => invoice %></td>
  </tr>
<% last_month, last_year = invoice.billed_on.month, invoice.billed_on.year %>
<% end %>
</table>

<p>zeige <%= @invoices.length %> Rechnungen für <%= params[:year] %>.</p>
